@model PagedList.IPagedList<WebApplication17.Models.SanPham>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<WebApplication17.Models.HangSP> dshang = ViewBag.dsh;
    List<int> hangsps = ViewBag.brands as List<int>;
}

<main class="main">
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
        <div class="container">
            <ol class="breadcrumb">

                <li class="breadcrumb-item active" aria-current="page"></li>
            </ol>
        </div>
    </nav>

    <div class="page-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-9 col-xl-4-5col">
                    <div class="products mb-3">
                        <div class="row productlist">
                            @foreach (var item in Model)
                            {
                                <div class="col-6 col-md-4 col-xl-3">
                                    <div class="product">
                                        <figure class="product-media">
                                            <a href="~/SanPhams/Details/@item.masp">
                                                @{
                                                    string[] imgs = new string[] { };
                                                    if (!string.IsNullOrEmpty(item.hinhanh))
                                                    {
                                                        imgs = item.hinhanh.Split(';');
                                                    }

                                                    string firstImg = imgs.Length > 0 ? imgs[0] : "noimage.jpg";
                                                    string secondImg = imgs.Length > 1 ? imgs[1] : firstImg; // nếu không có ảnh 2 thì dùng lại ảnh 1
                                                }

                                                <div class="product-img-wrapper">
                                                    <img src="@Url.Content("~/wwwroot/images/" + firstImg)"
                                                         alt="Product image"
                                                         class="product-image img-default" />
                                                    <img src="@Url.Content("~/wwwroot/images/" + secondImg)"
                                                         alt="Product hover image"
                                                         class="product-image img-hover" />
                                                </div>
                                            </a>

                                            <div class="product-action">
                                                <button id="addcart" data-product-id="@item.masp" class="btn-product btn-cart" title="Add to cart">
                                                    <span>Thêm vào giỏ</span>
                                                </button>
                                            </div>
                                        </figure>



                                        <div class="product-body">
                                            <h3 class="product-title"><a href="~/SanPhams/Details/@item.masp">@item.tensp</a></h3>
                                            <div class="product-price">
                                                @{
                                                    decimal giaGoc = item.giaban ?? 0;
                                                    decimal giaSauGiam = item.IsHotDeal == true ? giaGoc * 0.9m : giaGoc;
                                                }

                                                @if (item.IsHotDeal == true)
                                                {
                                                    <span style="text-decoration:line-through; color:gray; margin-right:6px;">
                                                        @giaGoc.ToString("#,##0") đ
                                                    </span>
                                                    <span style="color:red; font-weight:bold;">
                                                        @giaSauGiam.ToString("#,##0") đ
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span style="color:red;font-weight:bold;">
                                                        @giaGoc.ToString("#,##0") đ
                                                    </span>
                                                }
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <nav aria-label="Page navigation" class="text-center">
                        <ul class="pagination">
                            <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                                <a class="page-link page-link-prev" href="@Url.Action("Index", new { page = Model.PageNumber - 1})" aria-label="Previous" tabindex="-1" aria-disabled="@(Model.HasPreviousPage ? "false" : "true")">
                                    <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Trang trước
                                </a>
                            </li>

                            @for (int i = 1; i <= Model.PageCount; i++)
                            {
                                <li class="page-item @(i == Model.PageNumber ? "active" : "")" aria-current="page">
                                    <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                                </li>
                            }

                            <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                                <a class="page-link page-link-next" href="@Url.Action("Index", new { page = Model.PageNumber + 1})" aria-label="Next">
                                    Trang sau <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                                </a>
                            </li>
                        </ul>
                    </nav>

                </div>

                <aside class="col-lg-3 col-xl-5col order-lg-first">
                    <div class="sidebar sidebar-shop">
                        <div class="widget widget-categories">


                            <div class="widget">
                                <h3 class="widget-title">Hàng Sản Xuất</h3>

                                <div class="widget-body">
                                    <div class="filter-items">
                                        @foreach (var item in dshang)
                                        {
                                            <div class="filter-item">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="@item.mahang">
                                                    <label class="custom-control-label" for="@item.mahang">@item.tenhang</label>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>

                            <div class="widget">
                                <h3 class="widget-title">Giá Bán</h3>
                                <form>
                                    <div class="widget-body">
                                        <div class="filter-items">
                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-1" name="filter-price">
                                                    <label class="custom-control-label" for="price-1">Từ thấp đến cao</label>
                                                </div>
                                            </div>

                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-2" name="filter-price">
                                                    <label class="custom-control-label" for="price-2">Từ cao đến thấp</label>
                                                </div>
                                            </div>

                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-3" name="filter-price">
                                                    <label class="custom-control-label" for="price-3">Dười 10 triệu</label>
                                                </div>
                                            </div>

                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-4" name="filter-price">
                                                    <label class="custom-control-label" for="price-4">10 - 15 triệu</label>
                                                </div>
                                            </div>

                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-5" name="filter-price">
                                                    <label class="custom-control-label" for="price-5">15 - 20 triệu</label>
                                                </div>
                                            </div>

                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-6" name="filter-price">
                                                    <label class="custom-control-label" for="price-6">20 - 25 triệu</label>
                                                </div>
                                            </div>

                                            <div class="filter-item">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" class="custom-control-input" id="price-7" name="filter-price">
                                                    <label class="custom-control-label" for="price-7">trên 25 triệu</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>
</main>

<script>
    $(document).ready(function() {
        $('.btn-cart').click(function() {
            var productId = $(this).data('product-id');
            $.ajax({
                url: '@Url.Action("AddToCart", "SanPhams")',
                type: 'POST',
                data: { id: productId },
                success: function (result) {
                    if (result.success) {
                        toastr.success("Thêm vào giỏ hàng thành công", "Thành Công");
                        setTimeout(function () {
                            location.reload();
                        }, 1500);
                    } else {
                        window.location.href = '/Login/Index';
                    }
                },
                error: function() {
                    alert('Đã xảy ra lỗi!');
                }
            });

        });
    });

    $(document).ready(function () {
        $('input[type="checkbox"]').click(function () {
            getProductsByBrand();
        });

        $('input[type="radio"]').click(function () {
            getProductsByBrand();
        });

    });

    function getProductsByBrand() {
        var selectedBrands = [];
        // Lặp qua tất cả các checkbox đã chọn
        $('input[type="checkbox"]:checked').each(function () {
            // Lấy id của checkbox đã chọn và thêm vào mảng
            selectedBrands.push($(this).attr('id'));
        });
        var selectedPrice = $('input[type="radio"]:checked').attr('id');

        $.ajax({
            url: '/SanPhams/Index',
            type: 'POST',
            data: { brands: selectedBrands, price: selectedPrice },
            success: function (response) {
                var productListHtml = $(response).find('.productlist').html()
                $('.products .row').html(productListHtml);
            },
            error: function () {
                alert("LỖI");
            }
        });
    }
</script>